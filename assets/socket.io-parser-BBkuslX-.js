import{E as d}from"./@socket.io-Dkula2eQ.js";const N=typeof ArrayBuffer=="function",A=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer,h=Object.prototype.toString,E=typeof Blob=="function"||typeof Blob<"u"&&h.call(Blob)==="[object BlobConstructor]",b=typeof File=="function"||typeof File<"u"&&h.call(File)==="[object FileConstructor]";function u(t){return N&&(t instanceof ArrayBuffer||A(t))||E&&t instanceof Blob||b&&t instanceof File}function a(t,r){if(!t||typeof t!="object")return!1;if(Array.isArray(t)){for(let e=0,n=t.length;e<n;e++)if(a(t[e]))return!0;return!1}if(u(t))return!0;if(t.toJSON&&typeof t.toJSON=="function"&&arguments.length===1)return a(t.toJSON(),!0);for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e)&&a(t[e]))return!0;return!1}function g(t){const r=[],e=t.data,n=t;return n.data=f(e,r),n.attachments=r.length,{packet:n,buffers:r}}function f(t,r){if(!t)return t;if(u(t)){const e={_placeholder:!0,num:r.length};return r.push(t),e}else if(Array.isArray(t)){const e=new Array(t.length);for(let n=0;n<t.length;n++)e[n]=f(t[n],r);return e}else if(typeof t=="object"&&!(t instanceof Date)){const e={};for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=f(t[n],r));return e}return t}function C(t,r){return t.data=l(t.data,r),delete t.attachments,t}function l(t,r){if(!t)return t;if(t&&t._placeholder===!0){if(typeof t.num=="number"&&t.num>=0&&t.num<r.length)return r[t.num];throw new Error("illegal attachments")}else if(Array.isArray(t))for(let e=0;e<t.length;e++)t[e]=l(t[e],r);else if(typeof t=="object")for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&(t[e]=l(t[e],r));return t}const m=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],O=5;var o;(function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"})(o||(o={}));class R{constructor(r){this.replacer=r}encode(r){return(r.type===o.EVENT||r.type===o.ACK)&&a(r)?this.encodeAsBinary({type:r.type===o.EVENT?o.BINARY_EVENT:o.BINARY_ACK,nsp:r.nsp,data:r.data,id:r.id}):[this.encodeAsString(r)]}encodeAsString(r){let e=""+r.type;return(r.type===o.BINARY_EVENT||r.type===o.BINARY_ACK)&&(e+=r.attachments+"-"),r.nsp&&r.nsp!=="/"&&(e+=r.nsp+","),r.id!=null&&(e+=r.id),r.data!=null&&(e+=JSON.stringify(r.data,this.replacer)),e}encodeAsBinary(r){const e=g(r),n=this.encodeAsString(e.packet),i=e.buffers;return i.unshift(n),i}}function y(t){return Object.prototype.toString.call(t)==="[object Object]"}class p extends d{constructor(r){super(),this.reviver=r}add(r){let e;if(typeof r=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");e=this.decodeString(r);const n=e.type===o.BINARY_EVENT;n||e.type===o.BINARY_ACK?(e.type=n?o.EVENT:o.ACK,this.reconstructor=new B(e),e.attachments===0&&super.emitReserved("decoded",e)):super.emitReserved("decoded",e)}else if(u(r)||r.base64)if(this.reconstructor)e=this.reconstructor.takeBinaryData(r),e&&(this.reconstructor=null,super.emitReserved("decoded",e));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+r)}decodeString(r){let e=0;const n={type:Number(r.charAt(0))};if(o[n.type]===void 0)throw new Error("unknown packet type "+n.type);if(n.type===o.BINARY_EVENT||n.type===o.BINARY_ACK){const s=e+1;for(;r.charAt(++e)!=="-"&&e!=r.length;);const c=r.substring(s,e);if(c!=Number(c)||r.charAt(e)!=="-")throw new Error("Illegal attachments");n.attachments=Number(c)}if(r.charAt(e+1)==="/"){const s=e+1;for(;++e&&!(r.charAt(e)===","||e===r.length););n.nsp=r.substring(s,e)}else n.nsp="/";const i=r.charAt(e+1);if(i!==""&&Number(i)==i){const s=e+1;for(;++e;){const c=r.charAt(e);if(c==null||Number(c)!=c){--e;break}if(e===r.length)break}n.id=Number(r.substring(s,e+1))}if(r.charAt(++e)){const s=this.tryParse(r.substr(e));if(p.isPayloadValid(n.type,s))n.data=s;else throw new Error("invalid payload")}return n}tryParse(r){try{return JSON.parse(r,this.reviver)}catch{return!1}}static isPayloadValid(r,e){switch(r){case o.CONNECT:return y(e);case o.DISCONNECT:return e===void 0;case o.CONNECT_ERROR:return typeof e=="string"||y(e);case o.EVENT:case o.BINARY_EVENT:return Array.isArray(e)&&(typeof e[0]=="number"||typeof e[0]=="string"&&m.indexOf(e[0])===-1);case o.ACK:case o.BINARY_ACK:return Array.isArray(e)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class B{constructor(r){this.packet=r,this.buffers=[],this.reconPack=r}takeBinaryData(r){if(this.buffers.push(r),this.buffers.length===this.reconPack.attachments){const e=C(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const w=Object.freeze(Object.defineProperty({__proto__:null,Decoder:p,Encoder:R,get PacketType(){return o},protocol:O},Symbol.toStringTag,{value:"Module"}));export{o as P,w as p};
